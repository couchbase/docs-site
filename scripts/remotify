#!/usr/bin/env zx
'use strict'

const orig = argv._.shift()
const base = path.basename  (orig, '.yml')

await $`${__dirname}/patch-remote.mjs ${orig} > ${base}.remote.patch.yml`

const parts = base.split(/[-_.]/).filter(part => ! part.match(/^(|antora|playbook|remote|local|patch)$/))
const remotebase = parts.length ? parts.join('-') : $.env.USER
console.log(remotebase)

await $`mkdir -p playbooks`

await $`${__dirname}/patch-playbook.mjs ${base}.remote.patch.yml antora-playbook.yml > playbooks/${remotebase}.yml`
console.log(`Written playbooks/${remotebase}.yml`)

